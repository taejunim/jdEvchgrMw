<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jdEvchgrMw.controlChgr.service.impl.ControlChgrMapper">
    
    <update id="ctrlListUpdate" parameterType="controlChgrVO">

        UPDATE ctrl_list
           SET MW_KIND_CD   =   #{mwKindCd}
             , RES_DT       =   #{resDt}
             , RES_CD       =   #{resCd}
             , RES_RSN_CD   =   #{resRsnCd}

         WHERE 1=1

           AND CTRL_LIST_ID    =   #{ctrlListId}

    </update>

    <insert id="txMsgListInsert" parameterType="controlChgrVO">

        INSERT INTO TX_MSG_LIST (
                                    CTRL_LIST_ID
                                    , UUID
                                    , DATA_CREATE_DT
                                    , TX_DT
                                    , TX_MSG

                      ) VALUES (

                                    #{ctrlListId}
                                    , #{uuid}
                                    , #{dataCreateDt}
                                    , #{txDt}
                                    , #{txMsg}

                                )

    </insert>

    <update id="txMsgListUpdate" parameterType="controlChgrVO">

        UPDATE tx_msg_list

           SET RES_DT       =   #{resDt}
             , RES_CD       =   #{resCd}
             , RES_RSN_CD   =   #{resRsnCd}
             , RES_MSG      =   #{resMsg}

         WHERE 1=1

           AND UUID         =   #{uuid}

    </update>

    <insert id="chgrCurrAnnounceUpdate" parameterType="announceVO" >

        INSERT INTO EVCMS.CHGR_CURR_ANNOUNCE
        (
            PROVIDER_ID,
            ST_ID,
            CHGR_ID,
            KO_DETL,
            EN_DETL,
            MOD_UID,
            MOD_DT
        )
        VALUES
        (
            #{providerId},
            #{stId},
            #{chgrId},
            #{koDetl},
            #{enDetl},
            (
             SELECT CTRL_UID
               FROM EVCMS.TX_MSG_LIST TL RIGHT JOIN EVCMS.CTRL_LIST CL ON CL.CTRL_LIST_ID = TL.CTRL_LIST_ID
              WHERE UUID =#{uuid}
            ),
            #{resDt}
        )
        ON DUPLICATE KEY UPDATE
            KO_DETL = VALUES(KO_DETL),
            EN_DETL = VALUES(EN_DETL),
            MOD_UID = VALUES(MOD_UID),
            MOD_DT = VALUES(MOD_DT)

    </insert>

    <select id="selectTxMsg" parameterType="java.lang.String" resultType="java.lang.String">

        SELECT TX_MSG
        FROM TX_MSG_LIST
        WHERE UUID = #{uuid}
        ORDER BY CTRL_LIST_ID DESC
        LIMIT 1

    </select>

</mapper>